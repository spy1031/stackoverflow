<div class="container">

    <h2><%= @question.title %></h2>
    <hr style="margin-top: 0px;">

    <div class="row question" id="<%= @question.id %>">
      <div class="col-1 q-info">
        <div class="vote">
          <i class="fas fa-caret-up"></i>
          <p style="margin-bottom: 0;"><%= @question.upvotes_count %></p>
          <i class="fas fa-caret-down"></i>
        </div>
        <div class="favorite">
          <% if @question.is_favorited?(current_user) %>
            <i class="unfavorite-btn fas fa-heart text-danger"></i>
          <% else %>
            <i class="favorite-btn fas fa-heart"></i>
          <% end %>
          <p class="favorites_count"><%= @question.favorites_count %></p>
        </div>
      </div>
      <div class="col-9" style="margin-top: 20px;">
        <%= @question.content %>
      </div>
      <div class="col-2" style="margin-top: 20px;">
        <div class="user-box">
          <%= link_to user_path(@question.user) do %>
            <div class="user">
              <div class="user-avatar">
                <%= image_tag @question.user.avatar,width: '40px',height: '40px' if @question.user.avatar? %>
                <%= image_tag "http://via.placeholder.com/40x40", class: "rounded"  unless @question.user.avatar?%>
              </div>
              <div class="user-name">
                <h6><%= @question.user.name.upcase_first %></h6>
              </div>
            </div>
            <% end %>
            <div class="action-time">
              <em><%= @question.created_at.to_s[0..15] %></em>
            </div>
          </div>
      </div>
    </div>
    </div>
</div>

<script>
$(".favorite").on('click', '.favorite-btn', function(event){
  var question_id = event.target.parentNode.parentNode.parentNode.id;
  console.log(question_id);

    $.ajax({
      url: "/questions/" + question_id + "/favorite" ,
      method: "POST",
      dataType: "json",
      success: function(data) {
        console.log(data["favorites_count"]);

        $(".q-info").find(".favorite-btn").remove();
        $(".favorite").find("p").remove();
        $(".q-info").find(".favorite").append("<i class=\"unfavorite-btn fas fa-heart text-danger\"></i>");
        $(".q-info").find(".favorite").append("<p class=\"favorites_count\">"+ data["favorites_count"] +"</p>");
        console.log(question_id);
      }
    });
});

$(".favorite").on('click', '.unfavorite-btn', function(event){
  var question_id = event.target.parentNode.parentNode.parentNode.id;
  console.log(question_id);

    $.ajax({
      url: "/questions/" + question_id + "/unfavorite" ,
      method: "POST",
      dataType: "json",
      success: function() {
        var favorites_count = $(".favorite").find(".favorites_count").html();
        console.log(favorites_count);

        $(".q-info").find(".unfavorite-btn").remove();
        $(".favorite").find("p").remove();
        $(".q-info").find(".favorite").append("<i class=\"favorite-btn fas fa-heart\"></i>");
        $(".q-info").find(".favorite").append("<p>"+ [favorites_count -1] +"</p>");
        console.log(question_id);
      }
    });
});
</script>